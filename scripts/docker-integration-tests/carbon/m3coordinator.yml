listenAddress:
  value: "0.0.0.0:7201"

logging:
  # TODO restore to info level
  # level: info
  level: debug

metrics:
  scope:
    prefix: "coordinator"
  prometheus:
    handlerPath: /metrics
    listenAddress: 0.0.0.0:7203 # until https://github.com/m3db/m3/issues/682 is resolved
  sanitization: prometheus
  samplingRate: 1.0
  extended: none

clusters:
  - namespaces:
      - namespace: agg
        type: aggregated
        retention: 10h
        resolution: 5s
        downsample:
          all: false
      - namespace: unagg
        type: unaggregated
        retention: 10m
    client:
      config:
        service:
          env: default_env
          zone: embedded
          service: m3db
          cacheDir: /var/lib/m3kv
          etcdClusters:
            - zone: embedded
              endpoints:
                - dbnode01:2379
      writeConsistencyLevel: majority
      readConsistencyLevel: unstrict_majority

downsample:
  rules:
    mappingRules:
      - name: "nginx metrics"
        filter: "app:nginx*"
        aggregations: ["Last"]
        storagePolicies: ["5s:10h"]
    rollupRules:
      - name: "requests per second by status code"
        filter: "__name__:http_requests app:* status_code:* endpoint:*"
        transforms:
          - transform:
              type: "PerSecond"
          - rollup:
              metricName: "http_requests_by_status_code"
              groupBy: ["app", "status_code", "endpoint"]
              aggregations: ["Sum"]
        storagePolicies: ["5s:10h"]

tagOptions:
  idScheme: quoted
